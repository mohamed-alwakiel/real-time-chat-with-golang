<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Go WebSocket Chat</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 1rem;
        }

        #chat {
            border: 1px solid #ccc;
            padding: 1rem;
            height: 300px;
            overflow-y: auto;
            background: #f9f9f9;
        }

        .msg {
            margin-bottom: 8px;
        }

        .system {
            color: gray;
            font-style: italic;
        }

        .me {
            color: green;
        }

        .other {
            color: black;
        }

        #message {
            width: 70%;
        }
    </style>
</head>
<body>

<h2>üü¢ Go WebSocket Chat</h2>

<div>
    <label>üë§ Your name:</label>
    <input type="text" id="username" placeholder="Enter your name"/>
</div>

<div id="chat"></div>

<input type="text" id="message" placeholder="Type a message..."/>
<button onclick="sendMessage()">Send</button>

<script>
    let socket;
    let username = "";

    const chatBox = document.getElementById("chat");

    document.getElementById("username").addEventListener("blur", () => {
        if (socket || !document.getElementById("username").value.trim()) return;

        username = document.getElementById("username").value.trim();
        socket = new WebSocket("ws://localhost:8080/ws");

        socket.onopen = () => {
            // Send "join" message
            const joinMsg = {
                type: "join",
                sender: username
            };
            socket.send(JSON.stringify(joinMsg));
            logMessage("üü¢ Connected as " + username, "system");
        };

        socket.onmessage = (event) => {
            const data = JSON.parse(event.data);

            if (data.type === "join") {
                logMessage(`üîî ${data.sender} joined the chat`, "system");
            } else if (data.type === "leave") {
                logMessage(`üö™ ${data.sender} left the chat`, "system");
            } else if (data.type === "chat") {
                const style = data.sender === username ? "me" : "other";
                logMessage(`${data.sender}: ${data.message}`, style);
            }
        };

        socket.onclose = () => {
            logMessage("‚ùå Disconnected from server", "system");
        };
    });

    function sendMessage() {
        const msgInput = document.getElementById("message");
        const text = msgInput.value.trim();
        if (!text || !socket || !username) return;

        const chatMsg = {
            type: "chat",
            sender: username,
            message: text
        };

        socket.send(JSON.stringify(chatMsg));
        msgInput.value = "";
    }

    function logMessage(msg, className) {
        const div = document.createElement("div");
        div.className = "msg " + className;
        div.textContent = msg;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
    }
</script>

</body>
</html>
